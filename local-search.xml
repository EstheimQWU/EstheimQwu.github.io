<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>设计模式</title>
    <link href="/2020/08/11/0003/"/>
    <url>/2020/08/11/0003/</url>
    
    <content type="html"><![CDATA[<p>单例模式、简单工厂、策略模式、装饰模式与命令模式。</p><a id="more"></a><h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><h4 id="单线程情况"><a href="#单线程情况" class="headerlink" title="单线程情况"></a>单线程情况</h4><p>步骤1、新建单例类，并且用private改写其构造方法，使得类无法被其他方法实例化。<br>步骤2、在单例类中声明静态的实例化对象。<br>步骤3、在单例类中新建静态方法，返回一个单例的实例化对象。</p><h4 id="多线程加锁情况"><a href="#多线程加锁情况" class="headerlink" title="多线程加锁情况"></a>多线程加锁情况</h4><p><strong>lock确保当一个线程位于代码的临界区时，另一个线程不再进入临界区。如果其他线程试图进入锁定的代码，则它将一直等待（被阻止），直到该对象被释放。</strong></p><h5 id="双重枷锁"><a href="#双重枷锁" class="headerlink" title="双重枷锁"></a>双重枷锁</h5><h5 id="C-语境"><a href="#C-语境" class="headerlink" title="C#语境"></a>C#语境</h5><pre><code class="hljs csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span>&#123;    <span class="hljs-comment">// 声明</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton instance;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">object</span> syncRoot = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();<span class="hljs-comment">// 静态只读</span>    <span class="hljs-comment">// 私有的构造函数</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Singleton</span>(<span class="hljs-params"></span>)</span>&#123;    &#125;    <span class="hljs-comment">// 实例化</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title">GetInstance</span>(<span class="hljs-params"></span>)</span>&#123;        <span class="hljs-keyword">if</span>(instance == <span class="hljs-literal">null</span>)&#123;            <span class="hljs-keyword">lock</span> (syncRoot) &#123;                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;                    instance = <span class="hljs-keyword">new</span> Singleton();                &#125;            &#125;        &#125;    &#125;&#125;</code></pre><h5 id="JAVA语境"><a href="#JAVA语境" class="headerlink" title="JAVA语境"></a>JAVA语境</h5><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span></span>&#123;    <span class="hljs-comment">// 声明</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton instance;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object syncRoot = <span class="hljs-keyword">new</span> Object();<span class="hljs-comment">// 静态只读</span>    <span class="hljs-comment">// 私有的构造函数</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Singleton</span><span class="hljs-params">()</span></span>&#123;    &#125;    <span class="hljs-comment">// 实例化</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title">GetInstance</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">if</span>(instance == <span class="hljs-keyword">null</span>)&#123;            <span class="hljs-keyword">synchronized</span> (syncRoot)&#123; <span class="hljs-comment">// 另一种写法：Synchronize （Singleton.class）</span>                <span class="hljs-keyword">if</span> (instance == <span class="hljs-keyword">null</span>) &#123;                    instance = <span class="hljs-keyword">new</span> Singleton();                &#125;            &#125;        &#125;    &#125;&#125;</code></pre><h5 id="PYTHON语境"><a href="#PYTHON语境" class="headerlink" title="PYTHON语境"></a>PYTHON语境</h5><pre><code class="hljs reasonml">import timeimport threading<span class="hljs-keyword">class</span> <span class="hljs-constructor">Singleton(<span class="hljs-params">object</span>)</span>:    _instance_lock = threading.<span class="hljs-constructor">Lock()</span>    def <span class="hljs-constructor">__init__(<span class="hljs-params">self</span>,<span class="hljs-operator">*</span><span class="hljs-params">args</span>,<span class="hljs-operator">**</span><span class="hljs-params">kwargs</span>)</span>:        time.sleep(<span class="hljs-number">1</span>)    @classmethod    def get<span class="hljs-constructor">_instance(<span class="hljs-params">cls</span>,<span class="hljs-operator">*</span><span class="hljs-params">args</span>,<span class="hljs-operator">**</span><span class="hljs-params">kwargs</span>)</span>:        <span class="hljs-keyword">if</span> not hasattr(Singleton,&#x27;_instance&#x27;):            <span class="hljs-keyword">with</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Singleton</span>.</span><span class="hljs-module"><span class="hljs-identifier">_instance_lock</span>:</span></span>                <span class="hljs-keyword">if</span> not hasattr(Singleton,&#x27;_instance&#x27;):                    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Singleton</span>.</span><span class="hljs-module"><span class="hljs-identifier">_instance</span> </span></span>= <span class="hljs-constructor">Singleton(<span class="hljs-operator">*</span><span class="hljs-params">args</span>,<span class="hljs-operator">**</span><span class="hljs-params">kwargs</span>)</span>        return <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Singleton</span>.</span><span class="hljs-module"><span class="hljs-identifier">_instance</span></span></span><span class="hljs-module-access"><span class="hljs-module"></span></span><span class="hljs-module-access"><span class="hljs-module">d</span></span>ef task(arg):    obj = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Singleton</span>.</span></span>get<span class="hljs-constructor">_instance(<span class="hljs-params">arg</span>)</span>    print(obj)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):    t = threading.<span class="hljs-constructor">Thread(<span class="hljs-params">target</span>=<span class="hljs-params">task</span>,<span class="hljs-params">args</span>=[<span class="hljs-params">i</span>,])</span>    t.start<span class="hljs-literal">()</span>obj = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Singleton</span>.</span></span>get<span class="hljs-constructor">_instance()</span>print(obj)</code></pre><h5 id="GOLANG语境"><a href="#GOLANG语境" class="headerlink" title="GOLANG语境"></a>GOLANG语境</h5><pre><code class="hljs smali">type singleton struct &#123;&#125;var<span class="hljs-built_in"> instance </span>*singletonvar mu sync.Mutexfunc GetInstance() *singleton &#123;    mu.Lock()    defer mu.Unlock()   <span class="hljs-built_in"> if </span>instance == nil &#123;       <span class="hljs-built_in"> instance </span>= &amp;singleton&#123;&#125;     // unnecessary locking<span class="hljs-built_in"> if </span>instance already created    &#125;   <span class="hljs-built_in"> return </span>instance&#125;</code></pre><p>另一种：</p><pre><code class="hljs routeros">import (    <span class="hljs-string">&quot;sync&quot;</span>)type singleton struct &#123;&#125;var<span class="hljs-built_in"> instance </span>*singletonvar once sync.Oncefunc GetInstance() *singleton &#123;    once.<span class="hljs-keyword">Do</span>(func() &#123;       <span class="hljs-built_in"> instance </span>= &amp;singleton&#123;&#125;    &#125;)    return instance&#125;</code></pre><h5 id="C-语境-1"><a href="#C-语境-1" class="headerlink" title="C++语境"></a>C++语境</h5><p>我还没摸过C++，对力量一无所知…<br><a href="https://blog.csdn.net/hackbuteer1/article/details/7460019">https://blog.csdn.net/hackbuteer1/article/details/7460019</a></p><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lock</span></span><span class="hljs-class">&#123;</span><span class="hljs-keyword">private</span>:           CCriticalSection m_cs;<span class="hljs-keyword">public</span>:    Lock(CCriticalSection  cs) : m_cs(cs)    &#123;        m_cs.Lock();    &#125;    ~Lock()    &#123;        m_cs.Unlock();    &#125;&#125;;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span></span><span class="hljs-class">&#123;</span><span class="hljs-keyword">private</span>:    Singleton();    Singleton(<span class="hljs-keyword">const</span> Singleton &amp;);    Singleton&amp; <span class="hljs-keyword">operator</span> = (<span class="hljs-keyword">const</span> Singleton &amp;);<span class="hljs-keyword">public</span>:    <span class="hljs-function"><span class="hljs-keyword">static</span> Singleton *<span class="hljs-title">Instantialize</span><span class="hljs-params">()</span></span>;    <span class="hljs-keyword">static</span> Singleton *pInstance;    <span class="hljs-keyword">static</span> CCriticalSection cs;&#125;;Singleton* Singleton::pInstance = <span class="hljs-number">0</span>;<span class="hljs-function">Singleton* <span class="hljs-title">Singleton::Instantialize</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span>(pInstance == <span class="hljs-literal">NULL</span>)    &#123;   <span class="hljs-comment">//double check</span>        <span class="hljs-function">Lock <span class="hljs-title">lock</span><span class="hljs-params">(cs)</span></span>;           <span class="hljs-comment">//用lock实现线程安全，用资源管理类，实现异常安全</span>        <span class="hljs-comment">//使用资源管理类，在抛出异常的时候，资源管理类对象会被析构，析构总是发生的无论是因为异常抛出还是语句块结束。</span>        <span class="hljs-keyword">if</span>(pInstance == <span class="hljs-literal">NULL</span>)        &#123;            pInstance = <span class="hljs-keyword">new</span> Singleton();        &#125;    &#125;    <span class="hljs-keyword">return</span> pInstance;&#125;</code></pre><h3 id="简单工厂"><a href="#简单工厂" class="headerlink" title="简单工厂"></a>简单工厂</h3><p>步骤1、需要1个工厂类，switch语句判断产品分发情况<br>步骤2、需要具体的产品类与其抽象类。</p><h3 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h3><p>步骤1、创建策略类的抽象类<br>步骤2、创建具体的策略类与算法。<br>步骤3、创建context类，用于实例化策略类。<br>步骤4、在主函数中告诉context实例应该实例化哪一个策略类。</p><h3 id="装饰模式"><a href="#装饰模式" class="headerlink" title="装饰模式"></a>装饰模式</h3><p><strong>动态地给一个对象添加一些额外的职责，就增加功能而言，比生成子类更加灵活。</strong><br>步骤1、套娃</p><h3 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h3><p><strong>将一个请求封装为一个对象，从而使得可用不同的请求对客户进行参数化；对请求排队或者记录请求日志，以及支持可撤销的操作。</strong></p>]]></content>
    
    
    
    <tags>
      
      <tag>Design Pattern</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bottom</title>
    <link href="/2020/08/02/second/"/>
    <url>/2020/08/02/second/</url>
    
    <content type="html"><![CDATA[<p>This is abstract.</p><a id="more"></a><p>This is article text.</p>]]></content>
    
    
    
    <tags>
      
      <tag>test</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
